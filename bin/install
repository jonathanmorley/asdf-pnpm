#!/usr/bin/env bash

set -Eeuo pipefail

if [[ "${ASDF_INSTALL_TYPE:-version}" == 'ref' ]]; then
  echo >&2 "â›” This plugin does not support installing by ref."
  exit 1
fi

(
  cd "${ASDF_INSTALL_PATH}"

  curl -Lqs "https://registry.npmjs.org/pnpm/${ASDF_INSTALL_VERSION}" |
    grep -Eo '"tarball":"[^"]+"' |
    cut -d\" -f4 |
    xargs curl -Lqs |
    tar xzf - --strip-components=1 --no-same-owner

  for bin in bin/*; do
    ln "${bin}" "bin/$(basename "${bin}" ".js")"
  done
)
